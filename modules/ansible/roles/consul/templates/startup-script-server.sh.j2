#!/bin/bash
set -e

exec > >(tee /var/log/startup-script.log|logger -t startup-script -s 2>/dev/console) 2>&1

/opt/consul/bin/run-consul --server --cluster-tag-name {{ consul_cluster_tag_name }} --datacenter {{ consul_datacenter }} --config-dir {{ consul_config_dir }} --data-dir {{ consul_data_dir }} --bin-dir {{ consul_bin_dir }} --user {{ consul_user }} --enable-gossip-encryption --gossip-encryption-key {{ consul_gossip_encryption_key }} --enable-rpc-encryption --ca-path {{ consul_ca_file_path }} --cert-file-path {{ consul_cert_file_path }} --key-file-path {{ consul_key_file_path }} --http-max-conns-per-client {{ consul_http_max_connections_per_client }} --enable-connect --enable-mesh-gateway-wan-federation